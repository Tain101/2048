<!DOCTYPE html>
<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>2048</title>
        <script type="text/javascript">
        var canvasSize = 300;
        var margin = canvasSize / 160 * 3;

        </script>
        <link rel="stylesheet" type="text/css" href="./style.css">
        <script src="js/CanvasHandler.js"></script>
        <script src="js/Board.js"></script>
        <script src="js/Piece.js"></script>
        <script src="js/SlideManager.js"></script>
        <script src="js/Bot.js"></script>
        <script src="js/Game.js"></script>
        <style>

        </style>
    </head>

    <body>
        <span>
            <table>
                <tr><td>current score:              </td><td id="score">             0</td></tr>
                <tr class="a"><td><p>last score:    </td><td id="lastScore">         0</td></tr>
                <tr><td>current bot:                </td><td id="bot">               0</td></tr>
                <tr class="a"><td><p>generation:    </td><td id="generation">        0</td></tr>
                <tr><td>generation average:         </td><td id="generationAverage"> 0</td></tr>
                <tr class="a"><td><p>total average: </td><td id="average">           0</td></tr>
                <tr><td>highest:                    </td><td id="highest">           0</td></tr>
                <tr class="a"><td><p>lowest:        </td><td id="lowest">            0</td></tr>
                <tr><td>averageChange:              </td><td id="averageChange">     0</td></tr>
                <tr class="a"><td><p>lastChange:    </td><td id="lastChange">        0</td></tr>
            </table>
            <form>
                <p>FPS:</p>
                <input type="number" id="FPS"
                min="1" max="1000" step="1" value="60">
            </form>
        </span>


        <canvas id="canvas" width=300 height=300/>
        <script type="text/javascript">
            //user options
            // var fps = 1000;
            var fps = 1000/parseInt(document.getElementById("FPS").value, 10);
            var genetic = true;
            var restart = true;

            //objects
            var game = new Game();
            var board = new Board();
            var canvasHandler = new CanvasHandler(board);
            var slideManager = new SlideManager(board);

            //data

            var score = 0;
            var lastScore = 0;
            var generationScore = 0;
            var totalScore = 0;
            var highest = 0;
            var lowest = 0;
            var lastChange = 0;
            var averageChange = 0;
            var totalChange = 0;
            var currentPopulation = 0;
            var totalPopulation = 0;
            var currentGeneration = 0;
            var now = 0, then = 0, tpf = 0;

            function preload() {
                game.preload();
                board.preload();
                canvasHandler.preload(board);
            }

            function create() {
                game.create();
                board.create();
                canvasHandler.create(board);
                board.start();
            }

            function update() {
                game.update();
                board.update();
                canvasHandler.update(board);
                updateHtml();
            }

            function gameLoop () {
                fps = 1000/parseInt(document.getElementById("FPS").value, 10);
                now = Date.now();
                tpf = now - then;
                if (tpf > fps){
                    then = now - (tpf % fps);
                    update();
                }
            };

            preload();
            create();

            setInterval(gameLoop, 1000 / 50);

            var updateHtml = function() {
                var doc;
                doc = document.getElementById("score");
                doc.innerHTML = score;
                doc = document.getElementById("lastScore");
                doc.innerHTML = lastScore;
                doc = document.getElementById("bot");
                doc.innerHTML = currentPopulation;
                doc = document.getElementById("generation");
                doc.innerHTML = currentGeneration;
                doc = document.getElementById("generationAverage");
                doc.innerHTML = (generationScore / currentPopulation).toFixed(1);
                doc = document.getElementById("average");
                doc.innerHTML = (totalScore / totalPopulation).toFixed(1);
                doc = document.getElementById("highest");
                doc.innerHTML = highest;
                doc = document.getElementById("lowest");
                doc.innerHTML = lowest;
                doc = document.getElementById("averageChange");
                doc.innerHTML = averageChange.toFixed(1);
                doc = document.getElementById("lastChange");
                doc.innerHTML = lastChange;
            };

            var updateStats = function() {
                if (score > highest) {
                    highest = score;
                }
                if (score < lowest || lowest === 0) {
                    lowest = score;
                }
                lastChange = score - lastScore;
                totalChange += lastChange;
                averageChange = totalChange / totalPopulation;
                lastScore = score;
                score = 0;
                currentPopulation++;
                totalPopulation++;
                totalScore += bot.score;
                generationScore += bot.score;
            };

        </script>
    </body>

</html>

